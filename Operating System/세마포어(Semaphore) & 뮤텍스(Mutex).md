# 세마포어(Semaphore) & 뮤텍스(Mutex)

프로세스 간 메세지를 전송하거나, 공유메모리를 통해 공유된 자원에 여러 개의 프로세스가 동시에 접근하면 **Critical Section** 문제가 발생할 수 있다.

이를 해결하기 위해 **데이터를 한 번에 하나의 프로세스만 접근할 수 있도록 제한**을 두는 **동기화 방식**을 취해야 한다.

동기화 도구에는 대표적으로 **세마포어(Semaphore)** 와 **뮤텍스(Mutex)** 가 있다.

이들은 모두 공유된 자원의 데이터를 여러 스레드/프로세스가 접근하는 것을 막는 역할을 한다.

## 임계 영역(Critical Section)

여러 프로세스가 데이터를 공유하며 수행될 때, **각 프로세스에서 공유 데이터를 접근하는 프로그램 코드 블록**

즉, 여러 프로세스가 동일 자원을 동시에 참조하여 값(공유하는 변수명, 파일 등)이 오염될 위험 가능성이 있는 영역

프로그래밍시, 성능 향상을 위해 임계영역을 최소화하는 설계를 해야 한다.

## 세마포어(Semaphore)

> 멀치 프로그래밍 환경에서 공유된 자원에 대한 접근을 제한하는 방법

-   공유자원의 상태를 나타낼 수 있는  **카운터**로 생각할 때,
    -   사용하고 있는 스레드/프로세스의 수를 공통으로 관리하는 하나의 값을 이용해  상호배제를 달성한다.
    -   운영체제 또는 커널의 한 지정된 저장장치 내의 값
    -   일반적으로 비교적 긴 시간을 확보하는 리소스에 대한 이용
    -   유닉스 프로그래밍에서 세마포어는 운영체제의 리소스를 경쟁적으로 사용하는 다중 프로세스에서 행동을 조정하거나 또는 동기화하는 기술
-   공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근할 수 있다.
-   각 프로세스는 세마포어의 값을 확인하고 변경할 수 있다.
-   자원을 사용하지 않는 상태가 될 때, 대기하던 프로세스가 즉시 자원을 사용한다.
-   이미 다른 프로세스에 의해 사용중이라는 사실을 알게 되면, 재시도 전에 일정시간 대기해야 한다.
-   세마포어를 사용하는 프로세스는 그 값을 확인하고, 자원을 사용하는 동안에는 그 값을 변경함으로써 다른 세마포어 사용자들이 대기하도록 해야 한다.
-   세마포어는 이진수를 사용하거나 추가적인 값을 가질 수 있다.


## 뮤텍스(Mutex)

> 동시 프로그래밍에서 공유 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘

-   임계구역(Critical Section)을 가진 스레드들의 실행시간(Running Time)이 서로 겹치지 않고 각각 단독으로 실행(**상호배제_Mutual Exclution**)되도록 하는 기술
-   한 프로세스에 의해 소유될 수 있는 Key를 기반으로 한 상호배제 기법
    -   Key에 해당하는 어떤 객체(Object)가 있으며, 이 객체를 소유한 스레드/프로세스만이 공유자원에 접근할 수 있다.
-   다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 동기화(Synchronization) 또는 락(Lock)을 사용.
-   즉, 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.

## 세마포어와 뮤텍스 비교

| 항목 | 세마포어(Semaphore) | 뮤텍스(Mutex) |
| ----- | ----- | ----- |
|그림 | ![2-8](https://user-images.githubusercontent.com/38287375/174105433-938741b3-4d38-4baa-b57e-d68fa22deffd.png)|![3-6](https://user-images.githubusercontent.com/38287375/174105571-5a942749-2d2e-4203-8df7-121e0fd3e3a7.png)|
| 설명 | 사용 자원을 카운트하여 모든 자원이 사용되면 카운트 0 | 자원을 한 프로세스만 할당, 종료 시 다음 프로세스 할당 |
| 원리 | 화장실이 n칸(접근 가능 최대 허용치 만큼 동시 사용자 접근 가능), 세마포어 카운트가 0이면 대기 | 화장실에 들어가기 위한 열쇠를 한 사람이 가지고 있다면, 그 사람만이 들어갈 수 있다. 대기열(큐) 기다리게 됨 -> 세마포어의 일종 |
|목적 | Dead Lock을 피하기 위한 기술 중 하나 | Critical Section을 가진 Thread들이 running time이 서로 겹치지 않게 각 단독 실행 기술 |
|특징 | 공유 리소스에 접근할 수 있는 최대 허용치 만큼 동시 사용자 접근을 할 수 있게 하는 기술, 동기화 대상이 여러 개일 경우 사용 | 뮤텍스는 제어되는 섹션에 하나의 Thread만을 허용하기 때문에 해당 섹션에 접근하려는 다른 Thread들을 강제적으로 막아 첫 번째 Thread가 세션을 빠져 나올 때까지 대기 |


---
참조

https://chelseashin.tistory.com/40

http://blog.skby.net/%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4-semaphore/
# 시스템 콜 

## 시스템 콜이란? (System Call)

시스템 호출(System Call)은 **운영체제의 커널이 제공하는 서비스에 대해, 응용 프로그램의 요청에 따라 커널에 접근하기 위한 인터페이스**다.

보통 C나 C++과 같은 고급 언어로 작성된 프로그램들은 직접 시스템 호출을 사용할 수 없기 때문에 고급 API를 통해 시스템 호출에 접근하게 하는 방법이다.

<br />

## 시스템 콜이 필요한 이유

유저 레벨의 프로그램은 유저 레벨의 함수들만으로는 많은 기능을 구현하기 힘들기 때문에, 커널의 도움을 반드시 받아야 한다. 유저 프로세스에서 유저모드를 수행할 수 없기 때문에 반드시 **커널(kernel)** 에 관련된 것은 **커널모드**로 전환한 후에 해당 작업을 수행할 권한이 생긴다. 커널 모드를 통한 이러한 작업은 반드시 **시스템 콜(System Call)** 을 통해 수행하도록 설계되어 있다.

![sys1](https://user-images.githubusercontent.com/38287375/170082745-6a3ee417-8c3f-486a-9ff2-cff3326a2cc6.png)

- **유저 모드** : 유저가 접근할 수 있는 영역을 제한적으로 두고, 프로그램의 자원에 함부로 침범하지 못하는 모드
- **커널 모드** : 모든 자원(드라이버, 메모리, CPU 등)에 접근, 명령할 수 있는 모드

<br />

## 시스템 콜 처리 방식

1. 사용자 프로세스가 시스템 콜을 요청하면 제어가 커널로 넘어온다. (유저모드 -> 커널모드)
2. 커널은 내부적으로 각각의 시스템 콜을 구분하기 위해 기능별로 고유번호를 할당하고 그 번호에 해당하는 제어루틴을 커널 내부에 정의한다.
3. 커널은 요청받은 시스템 콜에 대응하는 기능번호를 확인한다.
4. 커널은 그 번호에 맞는 서비스 루틴을 호출한다.
5. 서비스 루틴을 모두 처리하고 나면 커널 모드에서 유저 모드로 다시 전환한다.

<br />

## 시스템 콜 유형

### 프로세스 제어 (Process Control)

-   끝내기(end), 중지(abort)
-   적재(load), 실행(execute)
-   프로세스 생성(create process)
-   프로세스 속성 획득과 설정(get process attribute and set process attribute)
-   시간 대기(wait time)
-   사건 대기(wait event)
-   사건을 알림(signal event)
-   메모리 할당 및 해제 : malloc, free

### 파일 조작 (File Manipulation)

-   파일 생성(create file), 파일 삭제(delete file)
-   열기(open), 닫기(close)
-   읽기(read), 쓰기(write), 위치 변경(reposition)
-   파일 속성 획득 및 설정(get file attribute and set file attribute)

### 장치 관리 (Devide Management)

-   장치를 요구(request devices), 장치를 방출release device)
-   읽기, 쓰기, 위치 변경
-   장치 속성 획득, 장치 속성 설정
-   장치의 논리적 부착(attach) 또는 분리(detach)

### 정보 유지 (Information Maintenance)

-   시간과 날짜의 설정과 획득(time)
-   시스템 데이터의 설정과 획득(date)
-   프로세스 파일, 장치 속성의 획득 및 설정

### 통신 (Communication)

-   통신 연결의 생성, 제거
-   메시지의 송신, 수신
-   상태 정보 전달
-   원격 장치의 부착 및 분리

<br />

## 시스템 콜 매개변수 전송

필요한 기능이나 시스템 환경에 따라 System Call이 발생할 때 좀 더 많은 정보가 필요할 수 있다. 그러한 정보가 담긴 매개변수를 운영체제에 전달하기 위해서는 약 3가지 방법이 있다.
1. **레지스터를 통한 전송** : 매개변수를 CPU 레지스터 내에 전달한다. 이 경우에 매개변수의 갯수가 CPU 내의 총 레지스터 개수보다 많을 수 있다. (직접적으로 전달되나, 레지스터 크기보다 더 많은 매개변수가 존재하므로 좋지 않은 방법)
2. **블록 or 테이블을 통한 전송** : 매개변수를 메모리 내의 블록이나 테이블에 저장하고 해당 메모리의 주소가 레지스터에 전달된다.
3. **스택을 통한 전송** : 매개변수는 프로그램에 의해 스택(stack)으로 전달(push) 될 수도 있다. (프로그램에 의해 스택에 넣어지고 운영체제에 의해 꺼내짐)

전달되는 매개변수들의 갯수나 길이를 제한하지 않기 때문에 **2번 방법**을 주로 사용한다.

<br />

---
참조

https://limjunho.github.io/2021/05/11/SystemCall.html

https://fjvbn2003.tistory.com/306